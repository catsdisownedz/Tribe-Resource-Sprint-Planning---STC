<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tribe Sprint Resource Planning</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{ --stc:#712C81; }

      /* Footer copyright */
      .site-footer{
        position: fixed;
        left: 0; right: 0;
        bottom: 6px;                 /* a hair lower */
        text-align: center;
        font-weight: 600;
        font-size: 12px;             /* smaller */
        color: rgba(200,176,248,.41);/* light purple */
        opacity: .9;
        z-index: 2000;               /* safely above everything */
        pointer-events: none;        /* doesn’t block clicks */
        text-shadow: 0 0 1px rgba(0,0,0,.15);
      }

    /* lock page scroll; only tables scroll */
    html, body{
      width:100%;
      max-width:100%;
      height:100%;
      overflow:hidden;
    }

    body{
      font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
      background:
        linear-gradient(180deg, rgba(113,44,129,0.04), rgba(113,44,129,0.02)),
        url("{{ url_for('static', filename='img/stc_bg.jpg') }}") center/cover fixed no-repeat;
      min-height:100vh;
    }

    /* --- header / logo / title --- */
    #stcLogo{
      position:relative;
      z-index:2147483647;
      display:inline-block;
      height:40px;
      width:auto;
      filter:drop-shadow(0 0 1.2px rgba(255,255,255,.73));
    }
    .brand-wrap{ display:flex; align-items:flex-start; gap:.75rem; color:#fff; position:relative; z-index:1001; }
    .brand-left{ display:flex; flex-direction:column; align-items:flex-start; gap:6px; }

    .brand-title{
      font-weight:800;
      letter-spacing:.2px;
      margin:0;
      color:#fff;
      font-size:clamp(22px,3.8vw,40px);
      line-height:1.1;
      padding-left:12px;
    }

    /* Current quarter pill under the logo */
    .q-pill{
      background:var(--stc);
      color:#fff;
      font-weight:700;
      padding:.25rem .7rem;
      border-radius:999px;
      line-height:1;
    }

    /* Admin button (lowered) */
    .admin-btn{
      position:absolute;
      top:44px;        /* lowered */
      right:16px;
      border-radius:999px;
      padding:.4rem .9rem;
      font-weight:600;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      z-index:1000;
    }
    .admin-btn:hover{ background:var(--stc); color:#fff; border-color:var(--stc); }

    /* Tabs shell */
    .tabs-shell{
      display:flex;
      flex-direction:column;
      height:calc(100vh - 130px);
      margin-top:14px;
      padding:12px 16px 14px;
      overflow:hidden;
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.06);
      position:relative;
      z-index:10;
    }

    .nav-tabs{
      --bs-nav-tabs-border-width:0;
      --bs-nav-tabs-link-active-bg:#fff;
      --bs-nav-tabs-link-active-border-color:#fff;
      border-bottom:1px solid #eee;
      padding:0 1rem;
    }
    .nav-tabs .nav-link{ border-radius:0; margin-right:.5rem; color:#6c6c6c; font-weight:600; }
    .nav-tabs .nav-link.active{ color:#000; border-bottom:3px solid var(--stc); }
    .nav-tabs .nav-link:hover{ color:var(--stc); }

    /* tighten space under tabs */
    .tab-content{
      background:#fff;
      border-radius:0 0 16px 16px;
      padding:.25rem 1rem 1rem;   /* smaller top padding */
      border-top:0;
      flex:1;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    /* dark overlay under content */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.45);
      z-index:0;
      pointer-events:none;
    }
    .container{ position:relative; z-index:1; }

    /* --- tables --- */
    .table-fixed{ width:100%; table-layout:auto; border-collapse:collapse; }
    .table-fixed th, .table-fixed td{
      padding:10px 12px;
      vertical-align:middle;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    /* sticky header rows */
    .table-fixed thead .th-labels th{
      position:sticky; top:0; z-index:3; background:#fff; border-bottom:1px solid #eee;
    }
    .table-fixed thead .th-filters th{
      position:sticky; top:42px; z-index:4;
      background:rgba(113,44,129,.06);   /* subtle purple tint */
      border-bottom:1px solid #eee;
      padding:6px 10px;
    }
    .table-fixed thead .th-filters input.col-filter{
      width:100%; background:#fff; display:block;
    }
    .col-filter{
      width:100%; box-sizing:border-box; height:34px; padding:6px 10px;
      border:1px solid #ddd; border-radius:8px; outline:none;
    }
    .col-filter:focus{ border-color:#b28cff; box-shadow:0 0 0 3px rgba(178,140,255,0.15); }

    /* scroll only inside table area */
    .scroll-wrap{
      position:relative;
      max-height:calc(100vh - 260px);
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      border-radius:12px;
      min-height:200px;
    }
    #book .scroll-wrap{ margin-top:0 !important; }

    /* row hover/active */
    .table-fixed tbody tr{ transition:background-color .15s ease, outline-color .15s ease; }
    .table-fixed tbody tr:hover{
      outline:2px solid rgba(113,44,129,.20);
      outline-offset:-2px;
    }
    .table-fixed tbody tr.table-active{ background:rgba(113,44,129,.08); }

    /* buttons theme */
    .btn-primary{
      --bs-btn-bg:var(--stc);
      --bs-btn-border-color:var(--stc);
      --bs-btn-hover-bg:#5f246c;
      --bs-btn-hover-border-color:#5f246c;
      --bs-btn-active-bg:#4f1e5a;
      --bs-btn-active-border-color:#4f1e5a;
    }
    .btn-outline-secondary:hover,
    .btn-outline-dark:hover{ background:var(--stc); color:#fff; border-color:var(--stc); }

    /* toolbars positioned where the green bar was */
    .tabs-shell{ position:relative; }
    .tabs-toolbar--book,
    .tabs-toolbar--view{
      position:absolute;
      top:25px;     /* adjust 52–60px to fine-tune */
      right:26px;   /* adjust 16–28px if needed */
      z-index:11;
    }

    /* responsive fallback */
    @media (max-width:640px){
      .tabs-toolbar--book,
      .tabs-toolbar--view{
        position:static;
        margin:6px 0 0 auto;
      }
    }
  </style>
</head>

<body>
  <div class="container py-4 position-relative">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start mb-1">
      <div class="brand-wrap">
        <div class="brand-left">
          <img id="stcLogo" src="{{ url_for('static', filename='img/stc_logo.png') }}?v=2" alt="stc">
          <span class="q-pill" id="currentQuarter" aria-label="Current quarter">{{ current_quarter or "" }}</span>
        </div>
        <h1 class="brand-title">Tribe Sprint Resource Planning</h1>
      </div>
      <a href="/admin/login" class="btn btn-outline-dark btn-sm admin-btn">Login as admin</a>
    </div>

    <!-- Tabs shell -->
    <div class="tabs-shell">
      <ul class="nav nav-tabs pt-2" id="tabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="book-tab" data-bs-toggle="tab" data-bs-target="#book" type="button" role="tab" aria-controls="book" aria-selected="true">Book Sprints</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="view-tab" data-bs-toggle="tab" data-bs-target="#view" type="button" role="tab" aria-controls="view" aria-selected="false">Edit Bookings</button>
        </li>
      </ul>

      <!-- single pair of tab-aligned toolbars -->
      <div class="tabs-toolbar tabs-toolbar--book" hidden>
        <button id="selectOk" class="btn btn-outline-secondary btn-sm" disabled>Book resource</button>
      </div>
      <div class="tabs-toolbar tabs-toolbar--view" hidden>
        <button id="exportBtn" class="btn btn-outline-secondary btn-sm">Download Excel</button>
      </div>

      <div class="tab-content">
        <!-- Book Sprints -->
        <div class="tab-pane fade show active" id="book" role="tabpanel" aria-labelledby="book-tab">
          <div class="table-responsive mt-0 scroll-wrap bg-white">
            <table class="table table-sm align-middle mb-0 table-fixed">
              <colgroup>
                <col style="width:12%">
                <col style="width:10%">
                <col style="width:16%">
                <col style="width:32%">
                <col style="width:14%">
                <col style="width:6%">
                <col style="width:6%">
              </colgroup>

              <thead id="tempHead" class="table-light">
                <tr class="th-labels">
                  <th>Tribe</th>
                  <th>Assignment Type</th>
                  <th>App</th>
                  <th>Resource</th>
                  <th>Role</th>
                  <th class="text-center">Reserved Sprints</th>
                </tr>
                <tr class="th-filters">
                  <th><input id="bTribe"    class="col-filter" placeholder="Search tribe"></th>
                  <th><input id="bType"     class="col-filter" placeholder="Search Assignment type"></th>
                  <th><input id="bApp"      class="col-filter" placeholder="Search app"></th>
                  <th><input id="bResource" class="col-filter" placeholder="Search resource"></th>
                  <th><input id="bRole"     class="col-filter" placeholder="Search role"></th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="tempBody"></tbody>
            </table>
          </div>
        </div>

        <!-- Edit Bookings -->
        <div class="tab-pane fade" id="view" role="tabpanel" aria-labelledby="view-tab">
          <div class="table-responsive scroll-wrap bg-white">
            <table class="table table-sm align-middle mb-0 table-fixed">
              <colgroup>
                <col style="width:12%">
                <col style="width:10%">
                <col style="width:14%">
                <col style="width:25%">
                <col style="width:12%">
                <col style="width:8%">
                <col style="width:1%">
                <col style="width:1%">
              </colgroup>

              <thead class="table-light">
                <tr class="th-labels">
                  <th>Tribe</th>
                  <th>App</th>
                  <th>Role</th>
                  <th>Resource</th>
                  <th>Assignment Type</th>
                  <th>Sprints</th>
                  <th></th>
                  <th class="text-end"></th>
                </tr>
                <tr class="th-filters">
                  <th><input id="fTribe"    class="col-filter" placeholder="Search tribe"></th>
                  <th><input id="fApp"      class="col-filter" placeholder="Search app"></th>
                  <th><input id="fRole"     class="col-filter" placeholder="Search role"></th>
                  <th><input id="fResource" class="col-filter" placeholder="Search resource"></th>
                  <th><input id="fType"     class="col-filter" placeholder="Search type"></th>
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody id="assignBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="site-footer">
    &copy; 2025 Zeina — Tribe Sprint Resource Planning
  </div>
  
  <!-- toolbar visibility control -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const tabs = document.getElementById('tabs');
      const bookBar = document.querySelector('.tabs-toolbar--book');
      const viewBar = document.querySelector('.tabs-toolbar--view');

      function showFor(targetId){
        const onBook = targetId === '#book';
        if (bookBar) bookBar.hidden = !onBook;
        if (viewBar) viewBar.hidden = onBook;
      }

      showFor('#book'); // initial state

      tabs?.addEventListener('shown.bs.tab', function(e){
        showFor(e.target.getAttribute('data-bs-target'));
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='js/booking.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
